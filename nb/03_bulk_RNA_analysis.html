<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.557">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lavinia I Fechete, Stig U Andersen, Mikkel H Schierup, Samuele Soraggi">

<title>Introduction to NGS data analysis - Bulk RNA Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EXW13D5861"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EXW13D5861', { 'anonymize_ip': true});
</script>
<script type="application/ld+json">
  {
    "@context": "https://schema.org/",
    "@type": "LearningResource",
    "@id": "https://hds-sandbox.github.io/NGS_summer_course_Aarhus/",
    "dct:conformsTo": {
      "http://purl.org/dc/terms/conformsTo": {
        "@id": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
        "@type": "CreativeWork"
      }
    },
    "name": "Introduction to NGS data analysis",
    "description": "A one-week summer school which provides an overview of current NGS technologies and directions in which these are currently progressing. Methods for assembling genomes from NGS data using either a reference genome or de novo assembly will be presented together with some emphasis on assessing NGS data quality (Quality control, accuracy of base calling). The course includes notebooks for the analysis of short- and long-read sequencing data, bulkRNA data and single-cell RNA sequencing data.",
    "keywords": [
      "single cell RNA",
      "NGS data",
      "genomics",
      "transcriptomics",
      "bulk RNA",
      "bioinformatics"
    ],
    "about": [
      {
        "@type": "DefinedTerm",
        "@id": "http://edamontology.org/topic_0091",
        "inDefinedTermSet": "http://edamontology.org",
        "termCode": "topic_0091",
        "name": "bioinformatics",
        "url": "https://bioportal.bioontology.org/ontologies/EDAM/?p=classes&conceptid=http%3A%2F%2Fedamontology.org%2Ftopic_0091"
      },
      {
        "@type": "DefinedTerm",
        "@id": "http://edamontology.org/data_3670",
        "inDefinedTermSet": "http://edamontology.org",
        "termCode": "data_3670",
        "name": "Online course",
        "url": "https://bioportal.bioontology.org/ontologies/EDAM/?p=classes&conceptid=http%3A%2F%2Fedamontology.org%2Fdata_3670"
      },
      {
        "@type": "DefinedTerm",
        "@id": "http://edamontology.org/topic_0622",
        "inDefinedTermSet": "http://edamontology.org",
        "termCode": "topic_0622",
        "name": "Genomics",
        "url": "https://www.ebi.ac.uk/ols4/ontologies/edam/classes/http%253A%252F%252Fedamontology.org%252Ftopic_0622"
      },
      {
        "@type": "DefinedTerm",
        "@id": "http://edamontology.org/topic_3308",
        "inDefinedTermSet": "http://edamontology.org",
        "termCode": "topic_3308",
        "name": "Transcriptomics",
        "url": "https://www.ebi.ac.uk/ols4/ontologies/edam/classes/http%253A%252F%252Fedamontology.org%252Ftopic_3308"
      }
    ],
    "abstract": "NGS technologies are fundamental in genomics and transcriptomics studies. In this course we set the foundations for the analysis of NGS data with various interactive exercises for genome alignment, genomics and transcriptome analysis. open source code, Slides and access information can be found at the webpage https://hds-sandbox.github.io/NGS_summer_course_Aarhus/.",
    "audience": [
      {
        "@type": "Audience",
        "audienceType": "Students"
      },
      {
        "@type": "Audience",
        "audienceType": "PhD students"
      },
      {
        "@type": "Audience",
        "audienceType": "Postdoctoral researchers"
      }
    ],
    "competencyRequired": [
      "Basic biology programming",
      "Basic python/R/bash programming (an advantage but not mandatory)",
      "Machine learning basics for bioinformatics (PCA, statistical testing)"
    ],
    "inLanguage": ["en-US"],
    "learningResourceType": ["tutorials"],
    "license": "https://spdx.org/licenses/CC-BY-4.0.html",
    "url": "https://hds-sandbox.github.io/NGS_summer_course_Aarhus/",
    "citation": [
        {
            "@type": "CreativeWork",
            "@id": "https://doi.org/10.5281/zenodo.8074603"
        } ],
     "funding":[
     	  {
            "@type": "Grant",
            "@id": "NNF grant number NNF20OC0063268"        	
        }
     ]
  }
</script>


<meta property="og:title" content="Introduction to NGS data analysis - Bulk RNA Analysis">
<meta property="og:description" content="">
<meta property="og:site_name" content="Introduction to NGS data analysis">
<meta property="og:locale" content="en_US">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/NGSlogo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Introduction to NGS data analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides.html"> 
<span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-access" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Access</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-access">    
        <li>
    <a class="dropdown-item" href="../access/UCloud.html">
 <span class="dropdown-text">UCloud</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../access/genomedk.html">
 <span class="dropdown-text">GenomeDK</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../galaxy/galaxy.html"> 
<span class="menu-text">Galaxy</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../nb/01_raw_data_alignment.html">
 <span class="dropdown-text">Alignment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../nb/02_VCF_variant_calling_analysis.html">
 <span class="dropdown-text">Variant analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../nb/03_bulk_RNA_analysis.html">
 <span class="dropdown-text">bulkRNA analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../nb/04_scRNAseq_analysis.html">
 <span class="dropdown-text">scRNA analysis</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hds-sandbox"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Bulk RNA Analysis</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Lavinia I Fechete, Stig U Andersen, Mikkel H Schierup, Samuele Soraggi </p>
            </div>
    </div>
      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#edger---data-filtering-and-normalization" id="toc-edger---data-filtering-and-normalization" class="nav-link active" data-scroll-target="#edger---data-filtering-and-normalization">EdgeR - Data filtering and Normalization</a>
  <ul class="collapse">
  <li><a href="#file-processing" id="toc-file-processing" class="nav-link" data-scroll-target="#file-processing">File processing</a></li>
  <li><a href="#create-the-dgelist-object" id="toc-create-the-dgelist-object" class="nav-link" data-scroll-target="#create-the-dgelist-object">Create the DGEList object</a></li>
  <li><a href="#preliminary-data-analysis" id="toc-preliminary-data-analysis" class="nav-link" data-scroll-target="#preliminary-data-analysis">Preliminary data analysis</a></li>
  <li><a href="#filtering-the-lowly-expressed-genes" id="toc-filtering-the-lowly-expressed-genes" class="nav-link" data-scroll-target="#filtering-the-lowly-expressed-genes">Filtering the lowly expressed genes</a></li>
  <li><a href="#normalization" id="toc-normalization" class="nav-link" data-scroll-target="#normalization">Normalization</a></li>
  <li><a href="#normalized-counts---exploratory-data-analysis" id="toc-normalized-counts---exploratory-data-analysis" class="nav-link" data-scroll-target="#normalized-counts---exploratory-data-analysis">Normalized counts - Exploratory Data analysis</a></li>
  </ul></li>
  <li><a href="#edger---testing-for-differentially-expressed-genes-degs" id="toc-edger---testing-for-differentially-expressed-genes-degs" class="nav-link" data-scroll-target="#edger---testing-for-differentially-expressed-genes-degs">EdgeR - Testing for Differentially expressed genes (DEGs)</a>
  <ul class="collapse">
  <li><a href="#degs-for-white-clover-s10-plants-treatment-vs-control" id="toc-degs-for-white-clover-s10-plants-treatment-vs-control" class="nav-link" data-scroll-target="#degs-for-white-clover-s10-plants-treatment-vs-control">DEGs for White clover S10 plants Treatment vs Control</a></li>
  <li><a href="#degs-for-white-clover-tienshan-treatment-vs-control" id="toc-degs-for-white-clover-tienshan-treatment-vs-control" class="nav-link" data-scroll-target="#degs-for-white-clover-tienshan-treatment-vs-control">DEGs for White clover Tienshan Treatment vs Control</a></li>
  <li><a href="#degs-for-s10tienshan-treatment-vs-control-wo-genotype-effects" id="toc-degs-for-s10tienshan-treatment-vs-control-wo-genotype-effects" class="nav-link" data-scroll-target="#degs-for-s10tienshan-treatment-vs-control-wo-genotype-effects">DEGs for S10+Tienshan Treatment vs Control w/o genotype effects</a></li>
  <li><a href="#explore-dge-results" id="toc-explore-dge-results" class="nav-link" data-scroll-target="#explore-dge-results">Explore DGE results</a>
  <ul class="collapse">
  <li><a href="#select-the-genes-which-appear-only-in-the-analysis-using-both-genotypes-for-further-examination." id="toc-select-the-genes-which-appear-only-in-the-analysis-using-both-genotypes-for-further-examination." class="nav-link" data-scroll-target="#select-the-genes-which-appear-only-in-the-analysis-using-both-genotypes-for-further-examination.">Select the genes which appear only in the analysis using both genotypes for further examination.</a></li>
  <li><a href="#linking-the-genes-selected-as-differentially-expressed-back-to-the-raw-read-counts" id="toc-linking-the-genes-selected-as-differentially-expressed-back-to-the-raw-read-counts" class="nav-link" data-scroll-target="#linking-the-genes-selected-as-differentially-expressed-back-to-the-raw-read-counts">Linking the genes selected as differentially expressed back to the raw read counts</a></li>
  <li><a href="#adding-functional-annotation-to-degs" id="toc-adding-functional-annotation-to-degs" class="nav-link" data-scroll-target="#adding-functional-annotation-to-degs">Adding functional annotation to DEGs</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled" title="Tutorial description">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tutorial description
</div>
</div>
<div class="callout-body-container callout-body">
<p>This tutorial will cover the steps for performing Differential Gene Expression on the RNA-seq data obtained from Galaxy. At the end of this tutorial you will be able to use <code>R</code> to</p>
<ul>
<li>Perform preliminary analyses of the RNA-seq results</li>
<li>Find differentially expressed genes between two conditions using <code>edgeR</code></li>
</ul>
</div>
</div>
<p>The present tutorial, like the rest of the course material, is available at our <a href="https://github.com/hds-sandbox/NGS_summer_course_Aarhus">open-source github repository</a>.</p>
<p>To use this notebook, use the <code>NGS (R)</code> kernel that contains the packages. Choose it by selecting <code>Kernel -&gt; Change Kernel</code> in the menu on top of the window.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="A few introductory points to run this notebook (click to show)">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A few introductory points to run this notebook (click to show)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>To use this notebook, use the <code>NGS (R)</code> kernel that contains the packages. Choose it by selecting <code>Kernel -&gt; Change Kernel</code> in the menu on top of the window.</li>
</ul>
<figure class="figure">
<img src="images/kernelchoice.png" width="500" alt="Kernel Choice" class="center figure-img">
</figure>
<ul>
<li>In this notebook you will use only R commands</li>
<li>On some computers, you might see the result of the commands once they are done running. This means you will wait some time while the computer is crunching, and only afterwards you will see the result of the command you have executed</li>
<li>You can run the code in each cell by clicking on the run cell button, or by pressing <kbd> Shift </kbd> + <kbd> Enter </kbd>. When the code is done running, a small green check sign will appear on the left side</li>
<li>You need to run the cells in sequential order, please do not run a cell until the one above finished running and do not skip any cells</li>
<li>Each cell contains a short description of the code and the output you should get. Please try not to focus on understanding the code for each command in too much detail, but rather try to focus on the output</li>
<li>You can create new code cells by pressing <kbd> + </kbd> in the Menu bar above.</li>
</ul>
</div>
</div>
</div>
<p><strong>Load the necessary R libraries</strong></p>
<div id="cell-3" class="cell" data-executioninfo="{&quot;elapsed&quot;:9,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592586765,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VennDiagram)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(formattable)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixOmics)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(edgeR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="edger---data-filtering-and-normalization" class="level1">
<h1>EdgeR - Data filtering and Normalization</h1>
<p>We will use the <code>edgeR</code> package to test for differentially expressed genes between our Control and Treatment Samples. You can read more about the edgeR package and its functionalities <a href="https://www.bioconductor.org/packages/release/bioc/vignettes/edgeR/inst/doc/edgeRUsersGuide.pdf">here</a>. This exercise largely follows their user manual.</p>
<section id="file-processing" class="level2">
<h2 class="anchored" data-anchor-id="file-processing">File processing</h2>
<p>The data for this exercise comes from the 12 tabular files with Reads per Gene counts generated by STAR Mapping in the <code>raw-data alignment</code> part of this course. We want to create a table where each column is a sample, and the content of the table are the read counts from STAR. We must merge the 12 files with Reads per Gene information into a single file.</p>
<ul>
<li>If you aligned datasets in the first notebook with jupyterlab, then you will find the files using the following command:</li>
</ul>
<div id="cell-7" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">system</span>(<span class="st">"find results/STAR_output/*_align_contigs_1_2 -name </span><span class="sc">\"</span><span class="st">*ReadsPerGene.out.tab</span><span class="sc">\"</span><span class="st">"</span>, <span class="at">intern=</span><span class="cn">TRUE</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(samples)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>Read_counts <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, <span class="fu">lapply</span>(samples, <span class="cf">function</span>(x) <span class="fu">read.delim</span>(<span class="at">file=</span>x, <span class="at">header =</span> <span class="cn">FALSE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>If you aligned datasets interactively with <code>Galaxy</code>, then you will need to
<ul>
<li>create the folder <code>tabular_files</code> into the <code>results</code> folder</li>
<li>copy the <code>tabular</code> files from <code>STAR</code> into the created folder. Each file must have the sample name and end by <code>ReadsPerGene.out.tab</code>. For example <code>S10_1_1ReadsPerGene.out.tab</code></li>
<li>run the following commands removing the <code>#</code> symbol</li>
</ul></li>
</ul>
<div id="cell-9" class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#samples &lt;- sort(system("find results/tabular_files/ -name \"*ReadsPerGene.out.tab\"", intern=TRUE))</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print(samples)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Read_counts &lt;- do.call(cbind, lapply(samples, function(x) read.delim(file=x, header = FALSE)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data frame has genes as rows and samples as columns and stores the gene expression counts (value representing the total number of sequence reads that originated from a particular gene in a sample) for each of the 12 samples. This data frame should have 12 columns and 366 rows.</p>
<div id="cell-11" class="cell" data-executioninfo="{&quot;elapsed&quot;:728,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592226501,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="695957c4-1210-4c5c-c576-5addfe921892" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Read_counts) <span class="ot">&lt;-</span> Read_counts[,<span class="dv">1</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Read_counts <span class="ot">&lt;-</span> Read_counts[<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="fu">nrow</span>(Read_counts)), <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">46</span>, <span class="at">by=</span><span class="dv">4</span>))]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Read_counts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"S10_1_1"</span>, <span class="st">"S10_1_2"</span>, <span class="st">"S10_1_3"</span>, <span class="st">"S10_2_1"</span>, <span class="st">"S10_2_2"</span>, <span class="st">"S10_2_3"</span>, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"TI_1_1"</span>, <span class="st">"TI_1_2"</span>, <span class="st">"TI_1_3"</span>, <span class="st">"TI_2_1"</span>, <span class="st">"TI_2_2"</span>, <span class="st">"TI_2_3"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Read_counts, <span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(Read_counts) <span class="co"># dimensions of the data frame</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import the Metadata table. This file, as its name suggests, contains information about each of the 12 RNA-seq samples, such as the treatment (Condition), genotype and replicate.</p>
<p>Note that the order of the rows in the Metadata table should be the same as the columns in the Read_counts file generated above.</p>
<div id="cell-13" class="cell" data-executioninfo="{&quot;elapsed&quot;:799,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592230356,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="98c192c7-46f3-4662-819b-81cddaafb3b7" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../Data/Clover_Data/metadata.csv"</span>, <span class="at">sep =</span><span class="st">";"</span>, <span class="at">row.names=</span><span class="dv">1</span>, <span class="at">stringsAsFactors=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to aid the following steps, we will create a Group for each sample (a new column in the metadata) based on the Genotype&amp;Condition of each sample and assign the three replicates to this group.</p>
<div id="cell-15" class="cell" data-executioninfo="{&quot;elapsed&quot;:440,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592249297,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="7b78e7c3-a246-4638-9e56-68605e85ad52" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Group <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">paste</span>(metadata<span class="sc">$</span>Genotype, metadata<span class="sc">$</span>Condition, <span class="at">sep=</span><span class="st">"_"</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> <span class="fu">cbind</span>(metadata,<span class="at">Group=</span>Group)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-the-dgelist-object" class="level2">
<h2 class="anchored" data-anchor-id="create-the-dgelist-object">Create the DGEList object</h2>
<p>We will merge the read counts and the metadata into a list-based data object named DGEList, which can be manipulated as any list object in R.</p>
<p>The main components of the DGEList object are the matrix “counts” containing our read per gene counts and a data.frame “samples” containing the metadata.</p>
<p>Note that all the genes with zero counts across all samples were eliminated.</p>
<div id="cell-17" class="cell" data-executioninfo="{&quot;elapsed&quot;:896,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592267233,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="64d6fedd-0394-4edc-ca79-519e5d30de63" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>DGEList <span class="ot">&lt;-</span> <span class="fu">DGEList</span>(Read_counts, <span class="at">remove.zeros =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>DGEList<span class="sc">$</span>samples<span class="sc">$</span>Condition <span class="ot">&lt;-</span> <span class="fu">relevel</span>(metadata<span class="sc">$</span>Condition, <span class="at">ref =</span> <span class="st">"Control"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>DGEList<span class="sc">$</span>samples<span class="sc">$</span>Genotype <span class="ot">&lt;-</span> metadata<span class="sc">$</span>Genotype</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>DGEList<span class="sc">$</span>samples<span class="sc">$</span>group <span class="ot">&lt;-</span> metadata<span class="sc">$</span>Group</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>DGEList</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preliminary-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="preliminary-data-analysis">Preliminary data analysis</h2>
<p>First, we will calculate the “pseudoCounts” as log2 of the reads per gene counts. <br> This is not part of the actual differential gene expression analysis but is helpful for data exploration and quality assessment. We will look at a histogram of one of the samples and a boxplot representation of the log2 counts for all the 12 samples. <br> Note that there are many genes with a low number of mapped reads and that there are differences between the average read counts for each library.</p>
<div id="cell-19" class="cell" data-executioninfo="{&quot;elapsed&quot;:853,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592276616,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="b0938de1-e0c6-44cc-a721-2f6fb5298908" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pseudoCounts <span class="ot">&lt;-</span> <span class="fu">log2</span>(DGEList<span class="sc">$</span>counts <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pseudoCounts)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pseudoCounts[ ,<span class="st">"S10_1_1"</span>], <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"Read counts"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(pseudoCounts, <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">las =</span> <span class="dv">3</span>, <span class="at">cex.names =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also create a PCA plot of the samples in order to assess the differences between the Genotypes and Conditions, but also between the replicates. In this plot the samples that are similar cluster together, while samples that are different are further apart. <br> In this type of plot, we would expect samples from the same group (the three replicates for each sample) to exhibit a similar gene expression profile thus clustering together while being separated from the other samples.</p>
<div id="cell-21" class="cell" data-executioninfo="{&quot;elapsed&quot;:892,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592287896,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="9e9c75ec-eaff-4de8-df49-e710d7723f6f" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>resPCA <span class="ot">&lt;-</span> <span class="fu">pca</span>(<span class="fu">t</span>(pseudoCounts), <span class="at">ncomp =</span> <span class="dv">6</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(resPCA, <span class="at">group =</span> metadata<span class="sc">$</span>Genotype, <span class="at">pch=</span>metadata<span class="sc">$</span>Condition,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend =</span> T, <span class="at">legend.title =</span> <span class="st">'Genotype'</span>, <span class="at">legend.title.pch =</span> <span class="st">'Condition'</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">title =</span> <span class="st">'PCA plot raw counts'</span>, <span class="at">style =</span> <span class="st">'ggplot2'</span>, <span class="at">size.xlabel =</span> <span class="dv">10</span>, <span class="at">size.ylabel =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-the-lowly-expressed-genes" class="level2">
<h2 class="anchored" data-anchor-id="filtering-the-lowly-expressed-genes">Filtering the lowly expressed genes</h2>
<p>As seen previously, many genes have a low number of read counts in our samples. The genes with very low counts across all libraries provide little evidence for differential expression, thus we should eliminate these genes before the analysis. <br> One of the filtering methods we can use is the “filterByExpr” function provided by the edgeR package. By default, this function keeps only the genes that have at least 10 reads per group, but other cutoffs can also be applied.</p>
<div id="cell-23" class="cell" data-executioninfo="{&quot;elapsed&quot;:302,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592373252,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="6aaf80e9-b0b5-493d-d217-a6233ffda53f" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>keep <span class="ot">&lt;-</span> <span class="fu">filterByExpr</span>(DGEList, <span class="at">group=</span>metadata<span class="sc">$</span>Group) <span class="co">#create the filter</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>DGEList <span class="ot">&lt;-</span> DGEList[keep, , keep.lib.sizes<span class="ot">=</span><span class="cn">FALSE</span>] <span class="co">#apply the filter to on the DGEList object</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(keep) <span class="co">#Check the number of genes that passed the filter</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalization" class="level2">
<h2 class="anchored" data-anchor-id="normalization">Normalization</h2>
<p>As we are working with multiple samples we need to normalize the read counts per gene in order to account for compositional and technical differences between the 12 RNA-seq libraries. For this, we will calculate normalization factors using the trimmed mean of M-values (TMM) method. You can read more about different normalization methods in the user manual.<br>
<br> Note that running “calcNormFactors” does not change the actual reads per gene counts, it just fills the “norm.factors” column in <code>DGEList$samples</code>.</p>
<p>These factors will be used to scale the read counts for each library. From the user guide: “A normalization factor below one indicates that a small number of high count genes are monopolizing the sequencing, causing the counts for other genes to be lower than would be usual given the library size.”</p>
<div id="cell-25" class="cell" data-executioninfo="{&quot;elapsed&quot;:706,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592376753,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="380c972e-581e-46e0-aba4-f79032597c21" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>DGEList <span class="ot">&lt;-</span> <span class="fu">calcNormFactors</span>(DGEList, <span class="at">method=</span><span class="st">"RLE"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>DGEList<span class="sc">$</span>samples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalized-counts---exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="normalized-counts---exploratory-data-analysis">Normalized counts - Exploratory Data analysis</h2>
<p>For data analysis purposes normalized log2 counts can be extracted from the DGEList object using the function CPM (counts per million).</p>
<p>We will generate the same plots as for the raw counts in order to compare the data before and after normalization.</p>
<p>Do the plots for normalized counts look different compared with the plots computed before data filtering and normalization?</p>
<div id="cell-27" class="cell" data-executioninfo="{&quot;elapsed&quot;:912,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592379673,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="7def7808-5abd-466f-ed36-5a4706348a25" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pseudoNormCounts <span class="ot">&lt;-</span> <span class="fu">cpm</span>(DGEList, <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">prior.count =</span> <span class="dv">1</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pseudoNormCounts)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(pseudoNormCounts[ ,<span class="st">"S10_1_1"</span>], <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"counts"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(pseudoNormCounts, <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">las =</span> <span class="dv">3</span>, <span class="at">cex.names =</span> <span class="dv">1</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>resPCA <span class="ot">&lt;-</span> <span class="fu">pca</span>(<span class="fu">t</span>(pseudoNormCounts), <span class="at">ncomp =</span> <span class="dv">6</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIndiv</span>(resPCA, <span class="at">group =</span> metadata<span class="sc">$</span>Genotype, <span class="at">pch=</span>metadata<span class="sc">$</span>Condition,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend =</span> T, <span class="at">legend.title =</span> <span class="st">'Genotype'</span>, <span class="at">legend.title.pch =</span> <span class="st">'Condition'</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">title =</span> <span class="st">'PCA plot normalized counts'</span>, <span class="at">style =</span> <span class="st">'ggplot2'</span>, <span class="at">size.xlabel =</span> <span class="dv">10</span>, <span class="at">size.ylabel =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="edger---testing-for-differentially-expressed-genes-degs" class="level1">
<h1>EdgeR - Testing for Differentially expressed genes (DEGs)</h1>
<p>We use <code>edgeR</code> for Differential Gene Expression using the GLM method (Generalized linear model) with treatment and genotype effects</p>
<p>After we concluded the exploratory data analysis and the filtering and normalization steps we can now start testing for differentially expressed genes between our samples.</p>
<p>For this, we first need to define a “design matrix” which describes our experimental design. We construct a matrix containing samples as rows and our previously defined groups (S10_Control, S10_Treatment, Tienshan_Control, Tienshan_Treatment) as columns. The samples belonging to each group are assigned a “1” in this matrix.</p>
<div id="cell-31" class="cell" data-executioninfo="{&quot;elapsed&quot;:738,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592391013,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="214fd833-17b3-465c-de56-6f60416ab515" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>design.matrix <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>Group)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(design.matrix) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(DGEList)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(design.matrix) <span class="ot">&lt;-</span> <span class="fu">levels</span>(metadata<span class="sc">$</span>Group)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>design.matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For easier pairwise comparisons between the groups we can create some “contrasts” using the “makeContrasts” function. This will tell the program which samples we will like to consider as our “Control” and which as our “Treatment” groups. The Control groups will be assigned a “-1” and the Treatment groups a “1”. When using multiple Control and Treatment samples in the same contrast we need to devide by the number of samples used as for example in the contrast S10_Tienshan, where we use both S10 and Ti samples.</p>
<p>For example, the contrast <code>S10 = S10_Treatment - S10_Control</code> will test for differentially expressed genes between the S10 treatment samples vs the S10 Control samples.</p>
<div id="cell-33" class="cell" data-executioninfo="{&quot;elapsed&quot;:291,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592481861,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="e7164a60-f51b-4349-85d7-4209efd7b617" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>contrasts <span class="ot">&lt;-</span> <span class="fu">makeContrasts</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">S10 =</span> S10_Treatment<span class="sc">-</span>S10_Control,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">Tienshan =</span> Tienshan_Treatment<span class="sc">-</span>Tienshan_Control,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">S10_Tienshan=</span> (S10_Treatment<span class="sc">+</span>Tienshan_Treatment)<span class="sc">/</span><span class="dv">2</span> <span class="sc">-</span> (S10_Control<span class="sc">+</span>Tienshan_Control)<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">levels=</span>design.matrix)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>contrasts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><em>Any ideas for other contrasts that migth be interesting to explore?</em></li>
</ul>
<p>The following cell will run two mandatory steps in order to fit a model in edgeR. First, the dispersion needs to be estimated, this is a measure of the degree of inter-library variation for each gene. Afterwards, a QL ( quasi-likelihood) model representing the sample design is fitted using the “glmQLFit” function. You can read more about these steps in the edgeR user guide.</p>
<div id="cell-36" class="cell" data-executioninfo="{&quot;elapsed&quot;:592,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592493067,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>DGEList <span class="ot">&lt;-</span> <span class="fu">estimateDisp</span>(DGEList, design.matrix)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glmQLFit</span>(DGEList, design.matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="degs-for-white-clover-s10-plants-treatment-vs-control" class="level2">
<h2 class="anchored" data-anchor-id="degs-for-white-clover-s10-plants-treatment-vs-control">DEGs for White clover S10 plants Treatment vs Control</h2>
<p>Find DEGs for White clover S10 plants in Treatment condition compared with the Control condition We will test for differentially expressed genes using the quasi-likelihood F-tests method. This is easily done just by running the “glmQFTest” function on the fit model and selecting one of the contrasts we created above (in this case the “S10” contrast).</p>
<p>Next, we will use the topTags function to extract the information about all the genes.</p>
<div id="cell-38" class="cell" data-executioninfo="{&quot;elapsed&quot;:3844,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592502170,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="98005ba9-3ece-4af3-dbbb-bda6f571f6fe" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>glmqlf_S10 <span class="ot">&lt;-</span> <span class="fu">glmQLFTest</span>(fit, <span class="at">contrast=</span>contrasts[,<span class="st">"S10"</span>])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>DEG_S10 <span class="ot">&lt;-</span> <span class="fu">topTags</span>(glmqlf_S10, <span class="at">n =</span> <span class="fu">nrow</span>(DGEList<span class="sc">$</span>counts))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>DEG_S10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have now created a table with certain parameters calculated for each of the genes analysed.</p>
<p><strong>logFC</strong> represents the base 2 logarithm of the fold change and it shows us how much the expression of the gene has changed between the two conditions. A logFC of 1 means a doubling in the read per gene count between the control and treatment samples. The genes with a logFC higher than 0 are upregulated while the genes with a logFC lower than 0 are downregulated between the control and treatment samples. <br> <strong>logCPM</strong> represents the average log2-counts-per-million, the abundance of the gene.</p>
<p><strong>F</strong> - F-statistic.</p>
<p><strong>PValue</strong> is the raw p-value.</p>
<p><strong>FDR</strong> (The false discovery rate) represents the adjusted p-value and is calculated using Benjamini and Hochberg’s algorithm. It controls the rate of false positive values under multiple testing. Usually, a threshold of under 5% is set for the FDR.</p>
<p>The important information for us in this table is stored in the “logFC” and the “FDR” columns. The top DE genes have small FDR values and large fold changes</p>
<p>Many of the genes in the samples are uninteresting for us, as they have a high FDR and/or low logFC values so we cannot consider them as differentially expressed.</p>
<p>We will apply a filtering step in order to keep only the statistically significant genes. We will filter out the genes with an FDR higher than 0.05 and an absolute logFC lower than 1.</p>
<div id="cell-41" class="cell" data-executioninfo="{&quot;elapsed&quot;:678,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592518729,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="7cebe4ec-b387-44a6-a992-6544f44d8803" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>DEG_S10_filtered <span class="ot">&lt;-</span> DEG_S10<span class="sc">$</span>table[DEG_S10<span class="sc">$</span>table<span class="sc">$</span>FDR <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> <span class="fu">abs</span>(DEG_S10<span class="sc">$</span>table<span class="sc">$</span>logFC) <span class="sc">&gt;</span> <span class="dv">1</span>,] <span class="co">#Filtering</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>DEG_S10_filtered <span class="ot">&lt;-</span> <span class="fu">rownames_to_column</span>(DEG_S10_filtered) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">gene_ID =</span> rowname) <span class="co">#Adding the gene_ID column</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DEG_S10_filtered)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(DEG_S10_filtered) <span class="co"># finding the number of genes that passed the filter </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also visualize the selected genes by plotting a Smear plot or a Volcano plot. The Genes that passed the filter are coloured in red, and the top 10 genes with the lowest FDR value are labelled with their gene ID.</p>
<p>We can see that the majority of the genes analysed are either not statistically significant or have a very small logFC.</p>
<div id="cell-43" class="cell" data-executioninfo="{&quot;elapsed&quot;:335,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592521575,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="15318014-668e-4b38-dd94-ddb9bb81f396" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotSmear</span>(glmqlf_S10,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">de.tags =</span> <span class="fu">rownames</span>(DEG_S10<span class="sc">$</span>table)[<span class="fu">which</span>(DEG_S10<span class="sc">$</span>table<span class="sc">$</span>FDR <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> <span class="fu">abs</span>(DEG_S10<span class="sc">$</span>table<span class="sc">$</span>logFC) <span class="sc">&gt;</span> <span class="dv">1</span>)])</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span>DEG_S10_filtered<span class="sc">$</span>logCPM[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">y=</span>DEG_S10_filtered<span class="sc">$</span>logFC[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels=</span>DEG_S10_filtered<span class="sc">$</span>gene_ID[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], <span class="at">cex=</span><span class="fl">0.7</span>, <span class="at">pos=</span><span class="dv">1</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also create a heatmap with the log2 read counts of the selected differentially expressed genes so that we can visualise the differences in normalized counts between the Control and the Treatment samples.</p>
<p>The genes are ordered by the FDR value.</p>
<div id="cell-45" class="cell" data-executioninfo="{&quot;elapsed&quot;:903,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592598499,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="340a6abb-dfc0-433f-f987-8d79f7ed0437" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>annot_col <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">row.names =</span> <span class="fu">colnames</span>(pseudoNormCounts)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>], <span class="at">Condition =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Control"</span>, <span class="dv">3</span>),<span class="fu">rep</span>( <span class="st">"Treatment"</span>, <span class="dv">3</span>)))                   </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="fu">as.matrix</span>(pseudoNormCounts[DEG_S10_filtered<span class="sc">$</span>gene_ID,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)]), <span class="at">cluster_rows =</span> F, <span class="at">cluster_col =</span> F, <span class="at">annotation_col =</span> annot_col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="degs-for-white-clover-tienshan-treatment-vs-control" class="level2">
<h2 class="anchored" data-anchor-id="degs-for-white-clover-tienshan-treatment-vs-control">DEGs for White clover Tienshan Treatment vs Control</h2>
<p>We can do this using the same functions as above and changing the contrast.</p>
<p>This time we will directly filter the differentially expressed genes using the same parameters as for the S10 samples.</p>
<div id="cell-47" class="cell" data-executioninfo="{&quot;elapsed&quot;:299,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592628511,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="22bd389e-fc28-43c6-ff33-e464164c06a6" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>glmqlf_Ti <span class="ot">&lt;-</span> <span class="fu">glmQLFTest</span>(fit, <span class="at">contrast=</span>contrasts[,<span class="st">"Tienshan"</span>])</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>DEG_Ti <span class="ot">&lt;-</span> <span class="fu">topTags</span>(glmqlf_Ti, <span class="at">n =</span> <span class="fu">nrow</span>(DGEList<span class="sc">$</span>counts))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>DEG_Ti_filtered <span class="ot">&lt;-</span> DEG_Ti<span class="sc">$</span>table[DEG_Ti<span class="sc">$</span>table<span class="sc">$</span>FDR <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> <span class="fu">abs</span>(DEG_Ti<span class="sc">$</span>table<span class="sc">$</span>logFC) <span class="sc">&gt;</span> <span class="dv">1</span>,]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>DEG_Ti_filtered <span class="ot">&lt;-</span> <span class="fu">rownames_to_column</span>(DEG_Ti_filtered) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">gene_ID =</span> rowname)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(DEG_Ti_filtered))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Nr of differentially expressed genes:"</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">nrow</span>(DEG_Ti_filtered))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now plot a Venn diagram with the DEGs for the two genotypes in order to observe the number of common and specific differentially expressed genes between the two genotypes as response to the cold exposure. You can see that a high percentage of the identified genes are common for the two genotypes, while each genotype has also specific genes.</p>
<div id="cell-49" class="cell" data-executioninfo="{&quot;elapsed&quot;:455,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592637394,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="72c86e42-33b5-4a6e-e3b3-30816eb231b6" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">venn.diagram</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">list</span>(DEG_S10_filtered<span class="sc">$</span>gene_ID, DEG_Ti_filtered<span class="sc">$</span>gene_ID),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">category.names =</span> <span class="fu">c</span>(<span class="st">"S10"</span> , <span class="st">"Tienshan"</span>),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">4</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"cornflowerblue"</span>, <span class="st">"yellowgreen"</span>),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="cn">NULL</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat.cex =</span> <span class="dv">1</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">output=</span><span class="cn">TRUE</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.draw</span>(vd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="degs-for-s10tienshan-treatment-vs-control-wo-genotype-effects" class="level2">
<h2 class="anchored" data-anchor-id="degs-for-s10tienshan-treatment-vs-control-wo-genotype-effects">DEGs for S10+Tienshan Treatment vs Control w/o genotype effects</h2>
<p>Until now we tested for DEGs specific for each of the two genotypes under cold treatment. We can also run a test where we ignore the genotype and just test for the differences in the cold response. <br> Consider the counts for both genotypes as a single dataset using the previously created contrast “S10_Tienshan”. <br> * Do the results look different compared with the previous tests?</p>
<div id="cell-51" class="cell" data-executioninfo="{&quot;elapsed&quot;:705,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592959246,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="9c18f993-436d-4f83-e440-339e6b267631" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>glmqlf_S10_Ti <span class="ot">&lt;-</span> <span class="fu">glmQLFTest</span>(fit, <span class="at">contrast=</span>contrasts[,<span class="st">"S10_Tienshan"</span>])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>DEG_S10_Ti <span class="ot">&lt;-</span> <span class="fu">topTags</span>(glmqlf_S10_Ti, <span class="at">n =</span> <span class="fu">nrow</span>(DGEList<span class="sc">$</span>counts))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>DEG_S10_Ti_filtered <span class="ot">&lt;-</span> DEG_S10_Ti<span class="sc">$</span>table[DEG_S10_Ti<span class="sc">$</span>table<span class="sc">$</span>FDR <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> <span class="fu">abs</span>(DEG_S10_Ti<span class="sc">$</span>table<span class="sc">$</span>logFC) <span class="sc">&gt;</span> <span class="dv">1</span>,]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>DEG_S10_Ti_filtered <span class="ot">&lt;-</span> <span class="fu">rownames_to_column</span>(DEG_S10_Ti_filtered)  <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">gene_ID =</span> rowname)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(DEG_S10_Ti_filtered))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Nr of differentially expressed genes:"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">nrow</span>(DEG_S10_Ti_filtered))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot the results from the 3 tests in a Venn diagram to visualize the number of common and unique genes</p>
<div id="cell-53" class="cell" data-executioninfo="{&quot;elapsed&quot;:464,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1654592962509,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="df9b7407-c040-4c1d-b480-312522f8b1a7" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">venn.diagram</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">list</span>(DEG_S10_filtered<span class="sc">$</span>gene_ID, DEG_Ti_filtered<span class="sc">$</span>gene_ID,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>           DEG_S10_Ti_filtered<span class="sc">$</span>gene_ID),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">category.names =</span> <span class="fu">c</span>(<span class="st">"S10"</span> , <span class="st">"Tienshan"</span>, <span class="st">"S10_Tienshan"</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"cornflowerblue"</span>, <span class="st">"yellowgreen"</span>, <span class="st">"thistle3"</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="cn">NULL</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat.cex =</span> <span class="dv">1</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">cat.fontface =</span> <span class="st">"bold"</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">output=</span><span class="cn">TRUE</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.draw</span>(vd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="explore-dge-results" class="level2">
<h2 class="anchored" data-anchor-id="explore-dge-results">Explore DGE results</h2>
<section id="select-the-genes-which-appear-only-in-the-analysis-using-both-genotypes-for-further-examination." class="level3">
<h3 class="anchored" data-anchor-id="select-the-genes-which-appear-only-in-the-analysis-using-both-genotypes-for-further-examination.">Select the genes which appear only in the analysis using both genotypes for further examination.</h3>
<p>We can use the “anti_join” function from the dplyr package to keep only the unique genes that appear only when using both genotypes.</p>
<div id="cell-56" class="cell" data-outputid="f1cb0416-2fc8-4d25-c378-3712e7cac131" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>S10_Ti_unique <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(DEG_S10_Ti_filtered, DEG_S10_filtered, <span class="at">by=</span><span class="st">"gene_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">anti_join</span>(DEG_Ti_filtered, <span class="at">by=</span><span class="st">"gene_ID"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>S10_Ti_unique</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="linking-the-genes-selected-as-differentially-expressed-back-to-the-raw-read-counts" class="level3">
<h3 class="anchored" data-anchor-id="linking-the-genes-selected-as-differentially-expressed-back-to-the-raw-read-counts">Linking the genes selected as differentially expressed back to the raw read counts</h3>
<p>How do the counts look for these genes, does it make sense that they are differentially expressed only when using the two genotypes?</p>
<div id="cell-58" class="cell" data-outputid="495b2bbd-e625-4c4c-95c0-5e6fba3ed677" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Read_counts <span class="ot">&lt;-</span> <span class="fu">rownames_to_column</span>(Read_counts) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">gene_ID =</span> rowname)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>S10_Ti_unique_counts <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(S10_Ti_unique[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>)], Read_counts, <span class="at">by=</span><span class="st">"gene_ID"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>S10_Ti_unique_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adding-functional-annotation-to-degs" class="level3">
<h3 class="anchored" data-anchor-id="adding-functional-annotation-to-degs">Adding functional annotation to DEGs</h3>
<p>Until now we looked only at gene IDs, but we can also add functional annotations to the DEGs. The functional annotations were generated using protein sequences and the <code>EggNOG</code> software.</p>
<p>Identifying the molecular function of the differentially expressed genes can help us do a literature survey in order to check if any of the genes discovered have been previously identified as being involved in the cold response.</p>
<div id="cell-60" class="cell" data-outputid="30170679-e42b-4184-c2fd-5451dfc656ae" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Functional_annotations <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"../Data/Clover_Data/Functional_Annotations.txt"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>S10_Ti_unique_FA <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(S10_Ti_unique[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>)], Functional_annotations, <span class="at">by=</span><span class="st">"gene_ID"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>S10_Ti_unique_FA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="alert-success">
<font size="+2"> <b> Tasks and Questions </b> </font>
</div>
<ul>
<li>Based on the results obtained in the analysis so far, would you change the cut-off for the FDR and logFC to be more strict or more permissive? Look back at the raw counts for different FDR and logFC values and set the thresholds as you find appropriate.</li>
</ul>
<p>You can also plot histograms with the FDR and logFC values.</p>
<div id="cell-63" class="cell" data-outputid="3ba78a4d-9651-40e1-b69b-55ee83104b77" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">hist</span>(DEG_S10<span class="sc">$</span>table<span class="sc">$</span>FDR , <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"FDR"</span>,  <span class="at">breaks=</span> <span class="dv">200</span>, <span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-64" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">hist</span>(DEG_S10<span class="sc">$</span>table<span class="sc">$</span>logFC , <span class="at">main =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">"logFC"</span>,  <span class="at">breaks=</span> <span class="dv">50</span>, <span class="at">xlim =</span> <span class="fu">range</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Separate the upregulated and downregulated genes for each genotype and append functional annotations to them.</li>
<li>Identify the genes that are commonly upregulated in S10 and Tienshan samples and the uniquely upregulated genes for each genotype.</li>
<li>Why do you think some of the proteins appear in duplicates? <br></li>
</ul>
<p>To answer these questions, it may be convenient to save summary tables from R and open them in excel. See the code below for examples of how to do this. Files can be downloaded by right-clicking on the file name.</p>
<p>If you are familiar with R functions, you are welcome to use those for counting.</p>
<div id="cell-66" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"DEG_Output_tables"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-67" class="cell" data-executioninfo="{&quot;elapsed&quot;:461,&quot;status&quot;:&quot;error&quot;,&quot;timestamp&quot;:1654593190300,&quot;user&quot;:{&quot;displayName&quot;:&quot;Lavinia Fechete&quot;,&quot;userId&quot;:&quot;03683080993527566677&quot;},&quot;user_tz&quot;:-120}" data-outputid="4fca6a22-48cd-44d5-f221-f9172ea5ad3d" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the table with the DEGs, Raw counts(just for the Ti samples in this case, change to columns (2:7) for the S10 samples) and Functional annotations</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>DEG_Ti_counts_FA <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(DEG_Ti_filtered[,<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">6</span>)], Read_counts[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span><span class="sc">:</span><span class="dv">13</span>)], <span class="at">by=</span><span class="st">"gene_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">inner_join</span>(Functional_annotations, <span class="at">by=</span><span class="st">"gene_ID"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Write the table to file</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(DEG_Ti_counts_FA, <span class="at">file =</span> <span class="st">"DEG_Output_tables/Ti_Treatment_Control_DGE.txt"</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Display the first 10 rows of the table</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DEG_Ti_counts_FA, <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Example for filtering and counting the Up/Down genes. You can easily filter using the “filter()” function just by specifying the dataframe and a logical argument.</p>
<div id="cell-69" class="cell" data-tags="[]" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>DEG_Ti_up <span class="ot">&lt;-</span> <span class="fu">filter</span>(DEG_Ti_counts_FA, logFC <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Nr of upregulated genes:"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">nrow</span>(DEG_Ti_up))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>DEG_Ti_down <span class="ot">&lt;-</span> <span class="fu">filter</span>(DEG_Ti_counts_FA, logFC <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Nr of downregulated genes:"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">nrow</span>(DEG_Ti_down))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can use the “inner_join” and the “anti_join” functions from the dplyr package to select the common and unique genes for each genotype:</p>
<p><code>example_file_joined &lt;- inner_join(file1, file2, by="gene_ID")</code></p>
<div class="callout callout-style-default callout-note callout-titled" title="Wrapping up">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Wrapping up
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this notebook, you have worked with RNA-seq results for two white clover genotypes exposed to one night of cold treatment, aiming to identify genes that change their expression in response to the cold treatment. You have learned to perform exploratory data analysis of raw and normalized RNA-seq read counts. You have also performed differential gene expression using <code>edgeR</code>.</p>
<p>Do you want to look for more analysis? We have an introductory course on bulkRNA analysis at the Danish Health Data Science Sandbox (held periodically in Copenhagen, <a href="https://heads.ku.dk/course/">keep an eye on the webpage where they list courses</a>). You can also find the material on the <strong>Transcriptomics Sandbox</strong> on uCloud (for danish users of uCloud), otherwise the course is documented in web format at the respective webpage.</p>
<p>&nbsp;</p>
<p align="center">
<a href="https://cloud.sdu.dk/app/jobs/create?app=transcriptomics" style="background-color: #4266A1; color: #FFFFFF; padding: 20px 20px; text-decoration: none; border-radius: 5px;"> Transcriptomics Sandbox </a>
</p>
<p><br> <br></p>
<p align="center">
<a href="https://hds-sandbox.github.io/bulk_RNAseq_course/" style="background-color: #4266A1; color: #FFFFFF; padding: 20px 20px; text-decoration: none; border-radius: 5px;"> bulkRNA analysis course </a>
</p>
<p><br> <br></p>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/hds-sandbox\.github\.io\/NGS_summer_course_Aarhus\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>